<div th:replace="~{layout/main :: layout(~{::section})}" xmlns:th="http://www.thymeleaf.org">
    <section>
        <!-- Header / Hero -->
        <div class="card mb-4">
            <h2 class="h1" style="margin-bottom: 4px;">Admin â€“ Symbol Management</h2>
            <p class="muted">Create and manage tradable instruments for Phi-Trading Exchange.</p>
        </div>

        <div class="grid cols-2 mb-4">
            <!-- Left: Create symbol form -->
            <div class="card">
                <h3 class="h2 mb-3">Create new symbol</h3>
                <form class="form" method="post" th:action="@{/admin/symbols}" th:object="${createForm}">
                    <div>
                        <label for="symbol">Symbol</label>
                        <input id="symbol" th:field="*{symbol}" type="text" placeholder="AAPL" required style="text-transform: uppercase;">
                        <div class="field-error" th:if="${#fields.hasErrors('symbol')}" th:errors="*{symbol}"></div>
                    </div>
                    <div>
                        <label for="name">Name</label>
                        <input id="name" th:field="*{name}" type="text" placeholder="Apple Inc." required>
                        <div class="field-error" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></div>
                    </div>
                    <div>
                        <label for="initialPrice">Initial Price</label>
                        <input id="initialPrice" th:field="*{initialPrice}" type="number" step="0.01" min="0" placeholder="150.00" required>
                        <div class="field-error" th:if="${#fields.hasErrors('initialPrice')}" th:errors="*{initialPrice}"></div>
                    </div>
                    <button class="btn btn-primary" type="submit" style="width: 100%">Create symbol</button>
                </form>
            </div>

            <!-- Right: Existing instruments table / insights -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                    <h3 class="h2" style="margin: 0;">Existing instruments</h3>
                    <span class="badge" th:text="${symbolCount} + ' total'"></span>
                </div>

                <div th:if="${instruments != null and !instruments.isEmpty()}">
                    <div class="table-wrapper">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Symbol</th>
                                    <th>Name</th>
                                    <th>Last Price</th>
                                    <th>Previous Close</th>
                                    <th>Updated At</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="ins : ${instruments}">
                                    <td>
                                        <strong th:text="${ins.symbol}">AAPL</strong>
                                        <span class="badge success" th:if="${ins.lastPrice != null and ins.previousClose != null and ins.lastPrice > ins.previousClose}">â†‘</span>
                                        <span class="badge danger" th:if="${ins.lastPrice != null and ins.previousClose != null and ins.lastPrice < ins.previousClose}">â†“</span>
                                    </td>
                                    <td th:text="${ins.name}">Apple Inc.</td>
                                    <td th:text="${#numbers.formatDecimal(ins.lastPrice, 1, 'COMMA', 2, 'POINT')}">$150.00</td>
                                    <td th:text="${#numbers.formatDecimal(ins.previousClose, 1, 'COMMA', 2, 'POINT')}">$149.00</td>
                                    <td class="muted" th:text="${#temporals.format(ins.updatedAt, 'yyyy-MM-dd HH:mm')}">2025-11-15 10:00</td>
                                    <td>
                                        <form th:action="@{'/admin/symbols/' + ${ins.symbol} + '/delete'}" method="post" style="display:inline;"
                                              onsubmit="return confirm('Are you sure you want to remove this symbol?');">
                                            <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                                        </form>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div th:if="${instruments == null or instruments.isEmpty()}" style="text-align: center; padding: 60px 24px;">
                    <div style="font-size: 5rem; margin-bottom: 16px; opacity: 0.3;">ðŸ“Š</div>
                    <p class="muted" style="font-size: 1.2rem;">No symbols added yet</p>
                    <p class="muted">Add your first trading symbol to get started</p>
                </div>
            </div>
        </div>

        <!-- Safe delete feedback: show holders when deletion prevented -->
        <div class="card warning" th:if="${deleteResult} != null and !${deleteResult.deleted}" style="margin-top: 12px;">
            <h3 class="h3" style="margin-top:0;">Cannot delete symbol</h3>
            <p class="muted" th:text="${deleteResult.message}">Cannot delete symbol XYZ because it is held by users.</p>
            <div th:if="${deleteResult.holderUsernames} != null and !${#lists.isEmpty(deleteResult.holderUsernames)}">
                <strong>Holders:</strong>
                <ul>
                    <li th:each="u : ${deleteResult.holderUsernames}" th:text="${u}">trader1</li>
                </ul>
            </div>
            <div class="muted">
                <span>Positions: <span th:text="${deleteResult.positionsCount}">0</span></span>
                <span style="margin-left:16px;">Orders: <span th:text="${deleteResult.ordersCount}">0</span></span>
            </div>
        </div>
    </section>
</div>

