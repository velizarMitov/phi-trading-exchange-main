<div th:replace="~{layout/main :: layout(~{::section})}" xmlns:th="http://www.thymeleaf.org">
    <section>
        <h2 class="h1 mb-4">üìâ Sell Stocks</h2>

        <div th:if="${success}" class="alert success" th:text="${success}"></div>
        <div th:if="${error}" class="alert danger" th:text="${error}"></div>

        <div class="grid cols-2">
            <div class="card">
                <h3 class="h2 mb-3">Place Sell Order</h3>
                <form class="form" method="post" th:action="@{/trade/sell}" th:object="${form}">
                    <div>
                        <label for="symbol">üìä Stock Symbol</label>
                        <div style="display:flex; gap:8px; align-items:center;">
                            <select id="symbol" class="input" th:field="*{symbol}" required>
                                <option value="" th:selected="${selectedSymbol == null}">Select a position</option>
                                <option th:each="p : ${positions}"
                                        th:value="${p.symbol}"
                                        th:selected="${#strings.equalsIgnoreCase(p.symbol, selectedSymbol)}"
                                        th:text="${p.symbol} + ' ‚Äì Qty: ' + ${#numbers.formatDecimal(p.quantity, 1, 'POINT', 0, 'POINT')} + ' @ Avg: ' + ${#numbers.formatDecimal(p.averagePrice, 1, 'POINT', 2, 'POINT')}">
                                    AAPL ‚Äì Qty: 10 @ Avg: 150.00
                                </option>
                            </select>
                            <a class="btn" th:href="@{/trade/sell(symbol=${form.symbol})}">Load</a>
                        </div>
                        <div class="text-error" th:if="${#fields.hasErrors('symbol')}" th:errors="*{symbol}"></div>
                    </div>
                    <div>
                        <label for="quantity">üì¶ Quantity to Sell</label>
                        <input id="quantity" th:field="*{quantity}" type="number" step="1" min="1" placeholder="Enter number of shares" required>
                        <div class="muted" th:if="${currentPosition != null}">Max: <span th:text="${#numbers.formatDecimal(currentPosition.quantity, 1, 'POINT', 0, 'POINT')}">0</span></div>
                        <div class="text-error" th:if="${#fields.hasErrors('quantity')}" th:errors="*{quantity}"></div>
                    </div>
                    <button class="btn btn-danger" type="submit" style="width: 100%; margin-top: 8px;">üí∏ Execute Sell Order</button>
                </form>
            </div>

            <div class="card" style="background: linear-gradient(135deg, rgba(245, 101, 101, 0.05), rgba(229, 62, 62, 0.05));">
                <h3 class="h2 mb-3">‚ÑπÔ∏è Instrument Info</h3>
                <div th:if="${selectedSymbol != null}" class="mb-2">
                    <div class="muted">Selected</div>
                    <div class="h2" th:text="${selectedSymbol}">AAPL</div>
                </div>
                <div class="mb-2">
                    <div class="muted">Current Price</div>
                    <div class="h1" th:text="${currentPrice != null ? #numbers.formatDecimal(currentPrice, 1, 'POINT', 2, 'POINT') : '‚Äî'}">‚Äî</div>
                </div>
                <div th:if="${currentPosition != null}">
                    <div class="muted">Your Position</div>
                    <div style="display:flex; gap:16px; margin-top:6px;">
                        <div>
                            <div class="muted">Quantity</div>
                            <div class="h2" th:text="${#numbers.formatDecimal(currentPosition.quantity, 1, 'POINT', 0, 'POINT')}">0</div>
                        </div>
                        <div>
                            <div class="muted">Avg Price</div>
                            <div class="h2" th:text="${#numbers.formatDecimal(currentPosition.averagePrice, 1, 'POINT', 2, 'POINT')}">$0.00</div>
                        </div>
                    </div>
                </div>
                <div th:if="${currentPosition == null}" class="muted" style="margin-top: 8px;">Select a position to see live price and your holdings.</div>
            </div>
        </div>

        <div class="card mt-4" style="background: linear-gradient(135deg, rgba(237, 100, 166, 0.05), rgba(219, 39, 119, 0.05)); border-color: rgba(237, 100, 166, 0.3);">
            <h3 class="h2 mb-2">‚ö†Ô∏è Important Reminders</h3>
            <ul style="margin: 0; padding-left: 24px; color: var(--text-secondary);">
                <li style="margin-bottom: 8px;">You can only sell shares you currently own</li>
                <li style="margin-bottom: 8px;">Sales are executed at current market price</li>
                <li style="margin-bottom: 8px;">Consider tax implications of selling</li>
                <li>Funds from sales are immediately available</li>
            </ul>
        </div>
    </section>
</div>

